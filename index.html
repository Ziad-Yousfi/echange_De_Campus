<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√âchange de Campus Par Ziad Yousfi</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-color: #f0f4f8;
      --text-color: #1a202c;
      --card-bg: rgba(255, 255, 255, 0.85);
      --accent: #10b981;
      --accent-hover: #059669;
      --accent-light: rgba(16, 185, 129, 0.1);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      --shadow-hover: 0 12px 48px rgba(16, 185, 129, 0.3);
      --gradient-1: linear-gradient(135deg, #10b981 0%, #34d399 100%);
      --gradient-2: linear-gradient(135deg, #059669 0%, #10b981 100%);
      --gradient-3: linear-gradient(135deg, #34d399 0%, #6ee7b7 100%);
      --gradient-4: linear-gradient(135deg, #6ee7b7 0%, #a7f3d0 100%);
    }

    [data-theme="dark"] {
      --bg-color: #0f172a;
      --text-color: #f1f5f9;
      --card-bg: rgba(30, 41, 59, 0.85);
      --accent: #10b981;
      --accent-hover: #34d399;
      --accent-light: rgba(16, 185, 129, 0.1);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      --shadow-hover: 0 12px 48px rgba(16, 185, 129, 0.4);
    }

    body {
      margin: 0;
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background 0.5s ease, color 0.5s ease;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      padding: 20px;
    }

    /* Animated Background */
    .bg-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: var(--gradient-1);
      opacity: 0.1;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0%, 100% { background: var(--gradient-1); }
      25% { background: var(--gradient-2); }
      50% { background: var(--gradient-3); }
      75% { background: var(--gradient-4); }
    }

    /* Floating Particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0.3;
      animation: float 20s infinite linear;
    }

    @keyframes float {
      0% {
        transform: translateY(100vh) translateX(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.3;
      }
      90% {
        opacity: 0.3;
      }
      100% {
        transform: translateY(-100px) translateX(100px) rotate(360deg);
        opacity: 0;
      }
    }

    /* Control Panel */
    .controls {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
    }

    .control-btn {
      padding: 12px 20px;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border: 2px solid var(--accent);
      border-radius: 12px;
      color: var(--text-color);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .control-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
      background: var(--accent);
      color: white;
    }

    .control-btn i {
      font-size: 18px;
    }

    .container {
      max-width: 800px;
      width: 100%;
      margin: 0 auto;
      padding-top: 80px;
    }

    h1 {
      font-size: 3.5rem;
      font-weight: 800;
      background: var(--gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
      margin-bottom: 10px;
      animation: fadeInDown 0.8s ease;
      letter-spacing: -1px;
    }

    .subtitle {
      text-align: center;
      color: var(--text-color);
      opacity: 0.7;
      margin-bottom: 40px;
      font-size: 1.1rem;
      animation: fadeInDown 0.8s ease 0.2s both;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      box-shadow: var(--shadow);
      padding: 35px;
      margin-bottom: 30px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: fadeInUp 0.8s ease 0.3s both;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: var(--shadow-hover);
    }

    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    label {
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
      color: var(--text-color);
      font-size: 0.95rem;
      opacity: 0.9;
    }

    input, select {
      padding: 16px 20px;
      border-radius: 14px;
      border: 2px solid rgba(0, 0, 0, 0.1);
      margin-bottom: 0;
      width: 100%;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.5);
      color: var(--text-color);
      font-size: 1rem;
      font-family: inherit;
    }

    [data-theme="dark"] input,
    [data-theme="dark"] select {
      background: rgba(0, 0, 0, 0.2);
      border-color: rgba(255, 255, 255, 0.1);
    }

    input:focus, select:focus {
      border-color: var(--accent);
      outline: none;
      box-shadow: 0 0 0 4px var(--accent-light);
      transform: translateY(-2px);
    }

    input::placeholder {
      color: var(--text-color);
      opacity: 0.5;
    }

    button {
      padding: 16px 32px;
      background: var(--gradient-1);
      color: #fff;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      border: none;
      border-radius: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
      position: relative;
      overflow: hidden;
      width: 100%;
      margin-top: 10px;
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    button:hover::before {
      width: 300px;
      height: 300px;
    }

    button:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.5);
    }

    button:active {
      transform: translateY(-1px) scale(0.98);
    }

    button span {
      position: relative;
      z-index: 1;
    }

    .annonce {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-left: 4px solid var(--accent);
      padding: 25px;
      margin-bottom: 20px;
      border-radius: 16px;
      opacity: 0;
      transform: translateY(30px) scale(0.95);
      animation: slideInCard 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      transition: all 0.3s ease;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .annonce::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--gradient-1);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }

    .annonce:hover {
      transform: translateX(8px) translateY(-4px);
      box-shadow: var(--shadow-hover);
      border-left-width: 6px;
    }

    .annonce:hover::before {
      opacity: 0.05;
    }

    @keyframes slideInCard {
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .annonce strong {
      color: var(--accent);
      font-size: 1.1rem;
      display: block;
      margin-bottom: 8px;
    }

    .annonce em {
      color: var(--accent);
      font-style: normal;
      font-weight: 600;
    }

    .annonce .contact {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
    }

    [data-theme="dark"] .annonce .contact {
      border-top-color: rgba(255, 255, 255, 0.1);
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      padding: 20px 30px;
      border-radius: 16px;
      box-shadow: var(--shadow-hover);
      z-index: 2000;
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid var(--accent);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .notification.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .notification.success {
      border-color: #10b981;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(52, 211, 153, 0.1) 100%);
    }

    .notification.error {
      border-color: #ef4444;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(249, 115, 22, 0.1) 100%);
    }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      h1 {
        font-size: 2.5rem;
      }

      .controls {
        top: 10px;
        right: 10px;
      }

      .control-btn {
        padding: 10px 16px;
        font-size: 12px;
      }

      .container {
        padding-top: 100px;
      }

      .card {
        padding: 25px;
      }
    }

    /* Smooth scroll */
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body>
  <div class="bg-animation"></div>
  <div class="particles" id="particles"></div>

  <div class="controls">
    <button class="control-btn" id="themeToggle">
      <span>üåô</span>
      <span>Th√®me</span>
    </button>
  </div>

  <div class="notification" id="notification">
    <span id="notificationIcon">‚úÖ</span>
    <span id="notificationText">Annonce envoy√©e avec succ√®s!</span>
  </div>

  <div class="container">
    <h1>üîÑ √âchange de Campus</h1>
    <p class="subtitle">Trouvez votre partenaire d'√©change en quelques clics</p>

    <form id="campusForm" class="card">
      <div class="form-group">
        <input type="text" id="nom" placeholder="Nom et pr√©nom" required>
      </div>
      <div class="form-group">
        <label for="currentCampus">üìç Campus actuel</label>
        <select id="currentCampus" required>
          <option value="">-- Choisir un campus --</option>
          <option value="Centre 1">Centre 1</option>
          <option value="Centre 2">Centre 2</option>
          <option value="Joulan">Joulan</option>
          <option value="Agdal 1">Agdal 1</option>
          <option value="Agdal 2">Agdal 2</option>
        </select>
      </div>
      <div class="form-group">
        <label for="desiredCampus">üéØ Campus souhait√©</label>
        <select id="desiredCampus" required>
          <option value="">-- Choisir un campus --</option>
          <option value="Centre 1">Centre 1</option>
          <option value="Centre 2">Centre 2</option>
          <option value="Joulan">Joulan</option>
          <option value="Agdal 1">Agdal 1</option>
          <option value="Agdal 2">Agdal 2</option>
        </select>
      </div>
      <div class="form-group">
        <input type="tel" id="phone" placeholder="üì± Num√©ro de t√©l√©phone" pattern="[0-9]{10}" required>
      </div>
      <button type="submit">
        <span id="submitText">Envoyer l'annonce</span>
        <span id="submitLoader" class="spinner" style="display: none;"></span>
      </button>
    </form>

    <div id="annoncesContainer"></div>
  </div>

<script>
  // üîπ CONFIGURATION FIREBASE
  const firebaseConfig = {
    apiKey: "",
    authDomain: "site-de-changement.firebaseapp.com",
    projectId: "site-de-changement",
    storageBucket: "site-de-changement.appspot.com",
    messagingSenderId: "1098798831039",
    appId: "1:1098798831039:web:aadd9d4f61b2ca0a57bd0a",
    measurementId: "G-KJZ8PXHGMN"
  };

  // Initialisation Firebase
  let db;
  try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    
    // V√©rifier la connexion (persistance optionnelle - compatible plan gratuit)
    db.enablePersistence().catch(err => {
      if (err.code == 'failed-precondition') {
        console.warn('Firestore: Persistance activ√©e sur plusieurs onglets');
      } else if (err.code == 'unimplemented') {
        console.warn('Firestore: Persistance non support√©e par ce navigateur');
      }
      // La persistance est optionnelle, on continue m√™me si elle √©choue
    });
    
    console.log('‚úÖ Firebase initialis√© avec succ√®s');
    console.log('üìã Plan: Spark (Gratuit) - Compatible ‚úÖ');
  } catch (error) {
    console.error('‚ùå Erreur d\'initialisation Firebase:', error);
    alert('Erreur de connexion √† Firebase. V√©rifiez votre configuration.');
  }

  // √âl√©ments DOM
  const form = document.getElementById('campusForm');
  const annoncesContainer = document.getElementById('annoncesContainer');
  const themeToggle = document.getElementById('themeToggle');
  const notification = document.getElementById('notification');
  const submitText = document.getElementById('submitText');
  const submitLoader = document.getElementById('submitLoader');
  const particlesContainer = document.getElementById('particles');

  // Cr√©ation des particules anim√©es
  function createParticles() {
    const particleCount = 50;
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.classList.add('particle');
      particle.style.left = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 20 + 's';
      particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
      particlesContainer.appendChild(particle);
    }
  }

  createParticles();

  // Mode sombre/clair
  const savedTheme = localStorage.getItem('theme');
  
  if (savedTheme) {
    document.body.setAttribute('data-theme', savedTheme);
    updateThemeButton();
  }

  themeToggle.addEventListener('click', () => {
    const body = document.body;
    const currentTheme = body.getAttribute('data-theme');
    
    if (currentTheme === 'dark') {
      body.removeAttribute('data-theme');
      localStorage.setItem('theme', 'light');
    } else {
      body.setAttribute('data-theme', 'dark');
      localStorage.setItem('theme', 'dark');
    }
    updateThemeButton();
  });

  function updateThemeButton() {
    const isDark = document.body.getAttribute('data-theme') === 'dark';
    themeToggle.innerHTML = `<span>${isDark ? '‚òÄÔ∏è' : 'üåô'}</span><span>${isDark ? 'Clair' : 'Sombre'}</span>`;
  }

  // Fonction de notification
  function showNotification(message, type = 'success') {
    const icon = document.getElementById('notificationIcon');
    const text = document.getElementById('notificationText');
    
    icon.textContent = type === 'success' ? '‚úÖ' : '‚ùå';
    text.textContent = message;
    notification.className = `notification ${type} show`;
    
    setTimeout(() => {
      notification.classList.remove('show');
    }, 3000);
  }

  // Soumission du formulaire
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const nom = document.getElementById('nom').value.trim();
    const currentCampus = document.getElementById('currentCampus').value;
    const desiredCampus = document.getElementById('desiredCampus').value;
    const phone = document.getElementById('phone').value.trim();
    
    if (!nom || !currentCampus || !desiredCampus || !phone) {
      showNotification('Veuillez remplir tous les champs', 'error');
      return;
    }

    if (phone.length !== 10 || !/^\d+$/.test(phone)) {
      showNotification('Le num√©ro de t√©l√©phone doit contenir 10 chiffres', 'error');
      return;
    }

    // Afficher le loader
    submitText.style.display = 'none';
    submitLoader.style.display = 'inline-block';

    try {
      // V√©rifier que Firebase est initialis√©
      if (!db) {
        throw new Error('Firebase n\'est pas initialis√©');
      }

      console.log('üì§ Envoi des donn√©es...', { nom, currentCampus, desiredCampus, phone });
      
      const docRef = await db.collection("annonces").add({
        nom,
        currentCampus,
        desiredCampus,
        phone,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      
      console.log('‚úÖ Document cr√©√© avec l\'ID:', docRef.id);
      
      form.reset();
      showNotification('Annonce envoy√©e avec succ√®s! üéâ');
      
      // Scroll vers les annonces
      setTimeout(() => {
        annoncesContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 500);
    } catch (error) {
      console.error('‚ùå Erreur d√©taill√©e:', error);
      console.error('Code d\'erreur:', error.code);
      console.error('Message d\'erreur:', error.message);
      
      let errorMessage = 'Erreur lors de l\'envoi. ';
      
      if (error.code === 'permission-denied') {
        errorMessage += 'Acc√®s refus√©. V√©rifiez les r√®gles de s√©curit√© Firestore dans la console Firebase.';
      } else if (error.code === 'unavailable') {
        errorMessage += 'Service indisponible. V√©rifiez votre connexion internet.';
      } else if (error.code === 'unauthenticated') {
        errorMessage += 'Authentification requise.';
      } else if (error.message) {
        errorMessage += error.message;
      } else {
        errorMessage += 'Veuillez r√©essayer.';
      }
      
      showNotification(errorMessage, 'error');
    } finally {
      submitText.style.display = 'inline';
      submitLoader.style.display = 'none';
    }
  });

  // Affichage en temps r√©el des annonces
  if (db) {
    db.collection("annonces")
      .orderBy("timestamp", "desc")
      .onSnapshot(
        snapshot => {
          console.log('üì• Donn√©es re√ßues:', snapshot.size, 'documents');
          annoncesContainer.innerHTML = '';
          
          if (snapshot.empty) {
            annoncesContainer.innerHTML = `
              <div class="card" style="text-align: center; opacity: 0.7;">
                <p>Aucune annonce pour le moment. Soyez le premier √† publier! üöÄ</p>
              </div>
            `;
            return;
          }

          snapshot.forEach((doc, index) => {
            const a = doc.data();
            const div = document.createElement('div');
            div.classList.add('annonce');
            div.style.animationDelay = `${index * 0.1}s`;
            
            // Formatage de la date si disponible
            let dateStr = '';
            if (a.timestamp && a.timestamp.toDate) {
              const date = a.timestamp.toDate();
              const now = new Date();
              const diff = now - date;
              const minutes = Math.floor(diff / 60000);
              const hours = Math.floor(diff / 3600000);
              const days = Math.floor(diff / 86400000);
              
              if (minutes < 1) dateStr = 'Il y a quelques secondes';
              else if (minutes < 60) dateStr = `Il y a ${minutes} minute${minutes > 1 ? 's' : ''}`;
              else if (hours < 24) dateStr = `Il y a ${hours} heure${hours > 1 ? 's' : ''}`;
              else dateStr = `Il y a ${days} jour${days > 1 ? 's' : ''}`;
            }
            
            div.innerHTML = `
              <strong>${a.nom}</strong>
              <p style="margin: 10px 0; line-height: 1.6;">
                Souhaite changer de <em>${a.currentCampus}</em> vers <em>${a.desiredCampus}</em>
              </p>
              <div class="contact">
                <span>üì±</span>
                <span>${a.phone}</span>
                ${dateStr ? `<span style="margin-left: auto; opacity: 0.6; font-size: 0.85rem;">${dateStr}</span>` : ''}
              </div>
            `;
            annoncesContainer.appendChild(div);
          });
        },
        error => {
          console.error('‚ùå Erreur Firestore:', error);
          console.error('Code d\'erreur:', error.code);
          
          let errorMsg = 'Erreur de connexion. ';
          if (error.code === 'permission-denied') {
            errorMsg = '‚ö†Ô∏è Acc√®s refus√©. Les r√®gles de s√©curit√© Firestore bloquent la lecture. V√©rifiez la console Firebase.';
          } else if (error.code === 'unavailable') {
            errorMsg = 'Service indisponible. V√©rifiez votre connexion internet.';
          }
          
          showNotification(errorMsg, 'error');
          
          annoncesContainer.innerHTML = `
            <div class="card" style="text-align: center; opacity: 0.7;">
              <p style="color: var(--accent);">‚ö†Ô∏è Erreur de chargement des annonces</p>
              <p style="font-size: 0.9rem; margin-top: 10px;">V√©rifiez la console pour plus de d√©tails</p>
            </div>
          `;
        }
      );
  } else {
    console.error('‚ùå Firebase n\'est pas initialis√©');
    annoncesContainer.innerHTML = `
      <div class="card" style="text-align: center; opacity: 0.7;">
        <p style="color: var(--accent);">‚ö†Ô∏è Firebase non initialis√©</p>
        <p style="font-size: 0.9rem; margin-top: 10px;">V√©rifiez la configuration Firebase</p>
      </div>
    `;
  }

  // Animation au scroll
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = '1';
        entry.target.style.transform = 'translateY(0)';
      }
    });
  }, observerOptions);

  // Observer les annonces
  setTimeout(() => {
    document.querySelectorAll('.annonce').forEach(annonce => {
      observer.observe(annonce);
    });
  }, 1000);
</script>
</body>
</html>

