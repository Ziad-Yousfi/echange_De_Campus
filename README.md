# Échange de Campus — Par Ziad Yousfi

**Échange de Campus** est une application web légère qui permet aux étudiants de publier et trouver des annonces d'échange de campus. L'interface est statique (HTML/CSS/JS) et utilise Firebase Firestore pour la persistance et Firebase Auth (anonyme) pour identifier les créateurs d'annonces.

---

## Fonctionnalités

- Publier une annonce : nom, campus actuel, campus souhaité, téléphone
- Lecture en temps réel des annonces
- Filtrage par campus
- Suppression d'une annonce par son propriétaire
- Authentification anonyme côté client (UID stocké dans `ownerUid`)
- Règles Firestore incluses pour sécuriser les écritures

---

## Structure du projet

- `site/` : sources du site (HTML/CSS/JS)
  - `index.html` : page principale
  - `config.example.js` : exemple de configuration Firebase
  - `config.js` : (optionnel, non commité) configuration privée
  - `firestore.rules` : règles Firestore recommandées

---

## Installation / Test local

1. Ouvrir le dossier `site/` dans VS Code.
2. Servir `site/` avec un serveur local (Live Server, http-server, ou XAMPP). Par exemple avec Live Server : clic droit `Open with Live Server`.
3. Ouvrir `http://127.0.0.1:5500` (ou l'URL affichée) dans le navigateur.

---

## Configuration Firebase

Le site attend une configuration Firebase côté client. Trois options :

1. (Simple) Modifier le fallback dans `site/index.html` (déjà présent) pour contenir vos clés.
2. (Recommandé pour GitHub Pages) Créer un fichier `config.js` local (non commité) contenant :

```js
// site/config.js
window.firebaseConfig = {
  apiKey: "VOS_CLES",
  authDomain: "votre-projet.firebaseapp.com",
  projectId: "votre-projet",
  storageBucket: "...",
  messagingSenderId: "...",
  appId: "...",
  measurementId: "..."
};
```

3. (Automatisé) Utiliser GitHub Actions pour injecter `config.js` au déploiement à partir de Secrets GitHub (voir section CI ci‑dessous).

> Remarque : l'`apiKey` côté client est publique par design. La sécurité repose sur les règles Firestore / Auth / App Check.

---

## Firestore Rules (recommandé)

Le fichier `site/firestore.rules` contient un exemple de règles qui :
- permettent la lecture publique,
- exigent l'authentification pour `create`,
- vérifient que `ownerUid == request.auth.uid`,
- autorisent `update`/`delete` seulement au propriétaire.

Pour activer : collez le contenu dans Firebase Console → Firestore → Rules ou déployez via `firebase deploy --only firestore:rules`.

---

## Authentification

Le client utilise Firebase Auth (anonyme) pour obtenir un `uid` et l'attacher au document `ownerUid`. Assurez-vous d'activer l'auth anonyme dans Firebase Console → Authentication → Sign-in method → Anonymous.

---

## Déploiement (GitHub Pages + injection sécurisée de config)

Si vous ne voulez pas committer `config.js`, utilisez GitHub Actions pour générer `site/config.js` depuis les Secrets du repo et publier `site/` :

Exemple de workflow (à placer dans `.github/workflows/deploy.yml`):

```yaml
name: Build and deploy site

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Create config.js from secrets
        env:
          API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          AUTH_DOMAIN: ${{ secrets.FIREBASE_AUTH_DOMAIN }}
          PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
          STORAGE_BUCKET: ${{ secrets.FIREBASE_STORAGE_BUCKET }}
          MESSAGING_SENDER_ID: ${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}
          APP_ID: ${{ secrets.FIREBASE_APP_ID }}
          MEASUREMENT_ID: ${{ secrets.FIREBASE_MEASUREMENT_ID }}
        run: |
          cat > site/config.js <<'EOF'
          // Generated by GitHub Actions
          window.firebaseConfig = {
            apiKey: "${API_KEY}",
            authDomain: "${AUTH_DOMAIN}",
            projectId: "${PROJECT_ID}",
            storageBucket: "${STORAGE_BUCKET}",
            messagingSenderId: "${MESSAGING_SENDER_ID}",
            appId: "${APP_ID}",
            measurementId: "${MEASUREMENT_ID}"
          };
          EOF

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./site
```

Instructions : ajouter vos clés dans GitHub Secrets, committer le workflow et pousser sur `main`.

---

## Sécurité & bonnes pratiques

- Ne placez jamais de clés de service (service account) côté client.
- Protégez les opérations sensibles via Firestore Rules ou un backend (Cloud Functions). 
- Activez App Check (reCAPTCHA v3) pour réduire les abus automatisés si nécessaire.
- Surveillez l'utilisation et configurez des alertes de budget.

---

## Contribuer

Fork, crée une branche, fais une PR. Pour les améliorations majeures (backend, modération), décris le plan et les impacts.

---

## Licence

Choisis une licence (par ex. MIT) et remplace cette section si besoin.

---

Pour toute aide (déploiement CI, règles, App Check), dis‑moi ce que tu veux que j'implémente et je le ferai.
